<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Valet Ops Live – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />

  <!-- Supabase v1 global -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>

  <!-- ✅ V0.912: hide page until auth decides (prevents flash-of-home) -->
  <style>
    body {
      visibility: hidden;
      background: blue;
    }

    body.auth-ok {
      visibility: visible;
    }

    /* Default: hide all links */
    .screen-links a {
      display: none;
    }

    /* OWNER / MANAGER: see everything */
    body.role-owner .screen-links a,
    body.role-manager .screen-links a {
      display: inline-flex;
    }

    /* (Kept for later if you ever allow employees on home again) */
    body.role-dispatcher .link-dispatcher,
    body.role-dispatcher .link-history {
      display: inline-flex;
    }

    body.role-keymachine .link-keymachine {
      display: inline-flex;
    }

    body.role-carwash .link-carwash {
      display: inline-flex;
    }

    body.role-wallboard .link-wallboard {
      display: inline-flex;
    }

    body.role-serviceadvisor .link-serviceadvisor {
      display: inline-flex;
    }

    body.role-loancar .link-loancar {
      display: inline-flex;
    }
  </style>

  <!-- ✅ Auth gate: HOME is owner/manager-only. Employees get redirected to their screen. -->
  <script type="module">
    import { requireAuth, wireSignOut } from "./auth.js?v=20251224a";

    document.addEventListener("DOMContentLoaded", async () => {
      const auth = await requireAuth({ page: "home" });
      if (!auth?.ok) return; // auth.js handles redirects

      // Only gets here if owner/manager is allowed
      document.body.classList.add("auth-ok");
      wireSignOut();
    });
  </script>
</head>

<body>
  <div class="app-shell">
    <header class="app-header">
      <img src="assets/optima-logo.jpg" alt="Optima Dealer Services" class="logo" />
      <div class="titles">
        <div class="brand">Optima Dealer Services</div>
        <div class="subtitle">Valet Operations Live Board</div>
      </div>

      <div class="header-right">
        <button id="signout-btn" class="btn small">Sign out</button>
        <div class="role-pill">Home</div>
      </div>
    </header>

    <main class="app-main app-main-center">
      <section class="section">
        <div class="section-header">
          <div>
            <div class="section-title">Choose a Screen</div>
            <div class="section-subtitle">
              Owner/Manager router only. Employees are redirected to their screen.
            </div>
          </div>
        </div>

        <div class="screen-links">
          <a class="btn btn-primary link-dispatcher" href="dispatcher.html">
            Dispatcher Screen
          </a>

          <a class="btn link-keymachine" href="keymachine.html">
            Key Machine Screen
          </a>

          <a class="btn link-carwash" href="carwash.html">
            Car Wash Screen
          </a>

          <a class="btn link-wallboard" href="wallboard.html">
            TV Wallboard
          </a>

          <a class="btn link-serviceadvisor" href="serviceadvisor.html">
            Service Advisor
          </a>

          <a class="btn link-loancar" href="loancar.html">
            Loan Car
          </a>

          <a class="btn link-history" href="history.html">
            History
          </a>
        </div>
      </section>
    </main>
  </div>
</body>

</html>