<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Valet Ops Live — Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css?v=20260110a" />

  <!-- Supabase v1 global -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>

  <!-- Auth gate + login wiring -->
  <script type="module">
    /*
      V0.912 LOGIN RULES
      - If NOT logged in → show login form
      - If logged in → redirect immediately to allowed screen
      - Do NOT wire login form if redirect happens
    */

    // Cache-bust to avoid GitHub Pages stale auth.js
    import { requireAuth, wireLoginForm } from "./auth.js?v=20260110a";

    document.addEventListener("DOMContentLoaded", async () => {
      const auth = await requireAuth({ page: "login" });

      // Only wire the form if we stayed on the login page
      if (auth?.ok) {
        wireLoginForm();
      }
    });
  </script>
</head>

<body class="public-login">
  <noscript>
    <div class="login-wrap">
      <div class="login-card">
        <div class="login-title">Valet Ops Live</div>
        <div class="login-error" style="display:block;">
          This app requires JavaScript to sign in.
        </div>
      </div>
    </div>
  </noscript>

  <div class="login-wrap">
    <div class="login-card">
      <div class="login-brandrow">
        <div class="login-mark" aria-label="Optima">O</div>
        <div class="login-brandtext">
          <div class="login-company">OPTIMA DEALER SERVICES</div>
          <div class="login-product">Valet Ops Live</div>
        </div>
      </div>

      <div class="login-title">Secure sign in</div>
      <div class="login-sub">
        This system is restricted to authorized dealership staff.
      </div>

      <form id="login-form">
        <div class="input-group">
          <label for="login-email">Email</label>
          <input id="login-email" class="input-text" type="email" autocomplete="username" required />
        </div>

        <div class="input-group" style="margin-top: 0.75rem;">
          <label for="login-password">Password</label>
          <input id="login-password" class="input-text" type="password" autocomplete="current-password" required />
        </div>

        <div class="login-row">
          <div class="login-meta">Use your dealership-issued credentials.</div>
          <a class="login-meta" href="landing.html" style="text-decoration:none;color:rgba(255,255,255,0.70);">Back</a>
        </div>

        <div class="login-actions">
          <button class="btn btn-primary" type="submit">Sign in</button>
          <a class="btn btn-ghost" href="mailto:info@optimadealerservices.co?subject=Valet%20Ops%20Live%20Access%20Request">Request access</a>
        </div>

        <div id="login-error" class="login-error"></div>

        <div class="login-foot">
          Internal operations software. Unauthorized access is prohibited.
        </div>
      </form>
    </div>
  </div>
</body>

</html>